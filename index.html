<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Mona | Guest Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* ========================================================================
           THEME: "NOIR ELITE"
           Deep blacks, gold accents, absolute minimalism.
        ======================================================================== */
        :root {
            --bg-deep: #050505;
            --bg-card: #121212;
            --accent-gold: #D4AF37;
            --text-primary: #F5F5F5;
            --text-muted: #666666;
            --border-subtle: rgba(255, 255, 255, 0.08);
            --font-display: 'Cinzel', serif;
            --font-body: 'Manrope', sans-serif;
            --ease-luxury: cubic-bezier(0.22, 1, 0.36, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0; background-color: var(--bg-deep);
            color: var(--text-primary); font-family: var(--font-body);
            height: 100vh; overflow: hidden; display: flex; justify-content: center;
        }

        /* ========================================================================
           VIEW MANAGER (Login -> Dashboard -> Chat)
        ======================================================================== */
        .view-container {
            width: 100%; max-width: 480px; height: 100%; position: relative;
            background: var(--bg-deep); overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .view-section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 30px; display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; transform: scale(0.95) translateY(20px);
            transition: all 0.6s var(--ease-luxury);
        }

        .view-section.active {
            opacity: 1; pointer-events: auto; transform: scale(1) translateY(0); z-index: 10;
        }

        /* ========================================================================
           VIEW 1: THE VAULT LOGIN
        ======================================================================== */
        #view-login { justify-content: center; align-items: center; text-align: center; }

        .brand-logo {
            font-family: var(--font-display); font-size: 32px; letter-spacing: 4px;
            color: var(--text-primary); margin-bottom: 40px; text-transform: uppercase;
            border-bottom: 1px solid var(--accent-gold); padding-bottom: 10px;
        }

        .login-card { width: 100%; }
        
        .input-group { position: relative; margin-bottom: 25px; }
        
        .luxury-input {
            width: 100%; background: transparent; border: none;
            border-bottom: 1px solid var(--text-muted); padding: 15px 5px;
            color: white; font-size: 18px; font-family: var(--font-display);
            letter-spacing: 2px; text-align: center; outline: none;
            transition: border-color 0.3s;
        }
        .luxury-input:focus { border-color: var(--accent-gold); }
        .luxury-input::placeholder { color: #333; font-family: var(--font-body); letter-spacing: 0; font-size: 14px; }

        .gold-btn {
            background: var(--accent-gold); color: black; border: none;
            padding: 16px 40px; font-size: 14px; letter-spacing: 1px;
            text-transform: uppercase; font-weight: 600; cursor: pointer;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: transform 0.2s; margin-top: 20px;
        }
        .gold-btn:active { transform: scale(0.95); }

        .error-msg { color: #ff4444; font-size: 12px; margin-top: 15px; opacity: 0; transition: opacity 0.3s; }

        /* ========================================================================
           VIEW 2: THE DASHBOARD (The $15k Feature)
        ======================================================================== */
        #view-dashboard { padding: 0; background: var(--bg-card); }

        .dash-header {
            padding: 30px; background: var(--bg-deep);
            border-bottom: 1px solid var(--border-subtle);
            display: flex; justify-content: space-between; align-items: center;
        }
        .guest-welcome h2 { margin: 0; font-family: var(--font-display); font-size: 20px; color: var(--accent-gold); }
        .guest-welcome p { margin: 5px 0 0; font-size: 12px; color: var(--text-muted); }

        .logout-btn { background: none; border: 1px solid var(--border-subtle); color: var(--text-muted); padding: 8px 12px; font-size: 10px; cursor: pointer; }

        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1px;
            background: var(--border-subtle); margin-bottom: 20px;
        }
        .stat-box {
            background: var(--bg-deep); padding: 20px; text-align: center;
        }
        .stat-value { font-size: 24px; font-family: var(--font-display); color: white; display: block; margin-bottom: 5px; }
        .stat-label { font-size: 10px; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; }

        /* THE CHAT AREA (Embedded) */
        .embedded-chat {
            flex: 1; display: flex; flex-direction: column; background: var(--bg-card); position: relative;
        }
        .chat-stream {
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px;
        }
        .chat-input-area {
            padding: 20px; background: var(--bg-deep); border-top: 1px solid var(--border-subtle);
            display: flex; gap: 10px;
        }
        
        /* Message Bubbles - Minimalist */
        .msg { max-width: 85%; padding: 12px 16px; font-size: 14px; line-height: 1.6; }
        .msg.bot { color: var(--text-muted); border-left: 2px solid var(--accent-gold); padding-left: 15px; }
        .msg.user { color: white; background: rgba(255,255,255,0.05); align-self: flex-end; border-radius: 4px; }
        
        #chat-input {
            flex: 1; background: transparent; border: none; color: white; outline: none; font-family: var(--font-body);
        }

    </style>
</head>
<body>

<div class="view-container">
    
    <div id="view-login" class="view-section active">
        <div class="brand-logo">Montreux</div>
        <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 40px;">PRIVATE GUEST PORTAL</p>
        
        <div class="login-card">
            <div class="input-group">
                <input type="text" id="booking-id" class="luxury-input" placeholder="BOOKING REFERENCE" autocomplete="off">
            </div>
            <div class="input-group">
                <input type="password" id="passcode" class="luxury-input" placeholder="ACCESS CODE" autocomplete="off">
            </div>
            
            <button class="gold-btn" onclick="Portal.login()">Access Suite</button>
            <div id="login-error" class="error-msg">Invalid Credentials</div>
        </div>
    </div>

    <div id="view-dashboard" class="view-section">
        <div class="dash-header">
            <div class="guest-welcome">
                <h2 id="guest-name">Welcome</h2>
                <p id="room-info">Loading suite details...</p>
            </div>
            <button class="logout-btn" onclick="Portal.logout()">SECURE EXIT</button>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-value" id="wifi-code">...</span>
                <span class="stat-label">Wi-Fi Access</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="curr-bill">...</span>
                <span class="stat-label">Current Bill</span>
            </div>
        </div>

        <div class="embedded-chat">
            <div id="chat-stream" class="chat-stream">
                <div class="msg bot">System Initialized. I am Mona, your dedicated concierge. How may I assist you this evening?</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Type a request..." onkeydown="if(event.key==='Enter') Portal.send()">
                <button class="gold-btn" style="padding: 10px 20px; margin: 0; font-size: 10px;" onclick="Portal.send()">SEND</button>
            </div>
        </div>
    </div>

</div>

<script>
    /**
     * MONA PORTAL KERNEL
     * Handles Authentication, Session State, and Secured Chat
     */
    const Portal = (() => {
        
        // --- 1. CONFIG & STATE ---
        const CONFIG = {
            webhookUrl: "https://n8n.srv1106816.hstgr.cloud/webhook/595269c9-1640-45c9-9c2b-861a69417966",
            // In a real app, this verifies against an API. For demo, we simulate DB.
            mockDB: {
                "RES-8821": { name: "Mr. Wick", room: "Penthouse 404", wifi: "GOLD_8821", bill: "$4,250", code: "1234" },
                "DEMO": { name: "Valued Guest", room: "Suite 101", wifi: "GUEST_101", bill: "$0.00", code: "0000" }
            }
        };

        const STATE = {
            user: null,
            token: null
        };

        const DOM = {
            views: {
                login: document.getElementById('view-login'),
                dash: document.getElementById('view-dashboard')
            },
            inputs: {
                booking: document.getElementById('booking-id'),
                code: document.getElementById('passcode'),
                chat: document.getElementById('chat-input')
            },
            labels: {
                error: document.getElementById('login-error'),
                name: document.getElementById('guest-name'),
                room: document.getElementById('room-info'),
                wifi: document.getElementById('wifi-code'),
                bill: document.getElementById('curr-bill')
            },
            stream: document.getElementById('chat-stream')
        };

        // --- 2. AUTHENTICATION ENGINE ---
        const init = () => {
            // Check persistence
            const saved = localStorage.getItem('mona_auth');
            if (saved) {
                const session = JSON.parse(saved);
                // Simple session validation (mock)
                if (CONFIG.mockDB[session.id]) {
                    loginSuccess(session.id);
                }
            }
        };

        const login = () => {
            const id = DOM.inputs.booking.value.toUpperCase();
            const code = DOM.inputs.code.value;
            
            // Validate against Mock DB
            const record = CONFIG.mockDB[id];
            
            if (record && record.code === code) {
                loginSuccess(id);
            } else {
                DOM.labels.error.style.opacity = '1';
                setTimeout(() => DOM.labels.error.style.opacity = '0', 2000);
            }
        };

        const loginSuccess = (id) => {
            const data = CONFIG.mockDB[id];
            STATE.user = data;
            STATE.token = "SECURE_" + Date.now(); // Fake Token
            
            // Persist
            localStorage.setItem('mona_auth', JSON.stringify({ id: id, timestamp: Date.now() }));

            // Update Dashboard
            DOM.labels.name.innerText = `Welcome, ${data.name}`;
            DOM.labels.room.innerText = data.room;
            DOM.labels.wifi.innerText = data.wifi;
            DOM.labels.bill.innerText = data.bill;

            // Transition View
            DOM.views.login.classList.remove('active');
            DOM.views.dash.classList.add('active');
        };

        const logout = () => {
            localStorage.removeItem('mona_auth');
            location.reload();
        };

        // --- 3. SECURE CHAT ENGINE ---
        const addMessage = (text, type) => {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            if (type === 'bot') div.innerHTML = marked.parse(text);
            else div.innerText = text;
            DOM.stream.appendChild(div);
            DOM.stream.scrollTop = DOM.stream.scrollHeight;
        };

        const send = async () => {
            const text = DOM.inputs.chat.value.trim();
            if (!text) return;
            
            DOM.inputs.chat.value = '';
            addMessage(text, 'user');

            try {
                // Here is the "Complex" part: We send the User Context to the AI
                const payload = {
                    chatInput: text,
                    sessionId: STATE.token,
                    // Injecting authenticated data so AI knows context
                    guestContext: {
                        name: STATE.user.name,
                        room: STATE.user.room,
                        bill: STATE.user.bill
                    }
                };

                const res = await fetch(CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await res.json();
                let reply = "Connection unstable.";
                if (Array.isArray(data) && data[0]) reply = data[0].output || data[0].text;
                else if (data.output || data.text) reply = data.output || data.text;
                
                addMessage(reply, 'bot');

            } catch (e) {
                console.error(e);
                addMessage("Secure link interrupted.", 'bot');
            }
        };

        // Initialize
        init();

        return { login, logout, send };

    })();
</script>

</body>
</html>
